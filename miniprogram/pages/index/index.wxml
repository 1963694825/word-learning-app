<!--pages/index/index.wxml-->
<view class="container">
  <!-- åŠ è½½çŠ¶æ€ -->
  <view wx:if="{{loading}}" class="loading">
    <text>åŠ è½½ä¸­...</text>
  </view>

  <view wx:else>
    <!-- è¯ä¹¦é€‰æ‹© -->
    <view class="books-card card">
      <view class="books-title">é€‰æ‹©è¯ä¹¦ (å…±{{books.length}}æœ¬)</view>
      <view wx:if="{{books.length === 0}}" style="padding: 20rpx; color: #999;">
        æš‚æ— è¯ä¹¦æ•°æ®,è¯·æ£€æŸ¥åç«¯æœåŠ¡...
      </view>
      <scroll-view wx:else scroll-x class="books-scroll">
        <view class="books-list">
          <view 
            wx:for="{{books}}" 
            wx:key="id" 
            class="book-item {{selectedBook && selectedBook.id === item.id ? 'active' : ''}}"
            bindtap="selectBook"
            data-id="{{item.id}}"
          >
            <view class="book-icon">ğŸ“š</view>
            <view class="book-name">{{item.name}}</view>
            <view class="book-count">{{item.word_count}}è¯</view>
            <view class="book-level">éš¾åº¦{{item.difficulty_level}}</view>
          </view>
        </view>
      </scroll-view>
    </view>


    <!-- è¯ä¹¦å­¦ä¹ ç»Ÿè®¡ -->
    <view wx:if="{{selectedBook && bookStats}}" class="book-stats-card card">
      <view class="book-stats-header">
        <text class="book-stats-title">{{selectedBook.name}} - å­¦ä¹ ç»Ÿè®¡</text>
        <text class="book-stats-progress">{{bookStats.progress}}%</text>
      </view>
      
      <view class="progress-bar">
        <view class="progress-fill" style="width: {{bookStats.progress}}%"></view>
      </view>
      
      <view class="book-stats-grid">
        <view class="book-stat-item">
          <text class="book-stat-value">{{bookStats.total_words}}</text>
          <text class="book-stat-label">æ€»å•è¯</text>
        </view>
        <view class="book-stat-item">
          <text class="book-stat-value learned">{{bookStats.learned_words}}</text>
          <text class="book-stat-label">å·²å­¦ä¹ </text>
        </view>
        <view class="book-stat-item">
          <text class="book-stat-value unlearned">{{bookStats.unlearned_words}}</text>
          <text class="book-stat-label">æœªå­¦ä¹ </text>
        </view>
        <view class="book-stat-item">
          <text class="book-stat-value mastered">{{bookStats.mastered_words}}</text>
          <text class="book-stat-label">å·²æŒæ¡</text>
        </view>
      </view>
    </view>

    <!-- ä»Šæ—¥ä»»åŠ¡ -->
    <view class="task-card card">
      <view class="task-header">
        <text class="task-title">{{selectedBook ? selectedBook.name : 'ä»Šæ—¥ä»»åŠ¡'}}</text>
        <text class="task-count">{{todayTask.total}}ä¸ªå•è¯</text>
      </view>
      <view class="task-detail">
        <text class="task-item">å¤ä¹ : {{todayTask.review.length}}ä¸ª</text>
        <text class="task-item">æ–°è¯: {{todayTask.new.length}}ä¸ª</text>
      </view>
      <button class="btn-primary" bindtap="startLearning">
        å¼€å§‹å­¦ä¹ 
      </button>
    </view>

    <!-- å¿«æ·æ“ä½œ -->
    <view class="actions-card card">
      <view class="action-title">å¿«æ·æ“ä½œ</view>
      <view class="action-buttons">
        <button class="action-btn" bindtap="startTest">
          <text class="action-icon">âœï¸</text>
          <text class="action-text">å¼€å§‹æµ‹è¯•</text>
        </button>
        <button class="action-btn" bindtap="goToWordbook">
          <text class="action-icon">ğŸ“</text>
          <text class="action-text">ç”Ÿè¯æœ¬</text>
        </button>
      </view>
    </view>
  </view>
</view>
