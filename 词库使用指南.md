# 词库数据使用指南

## 快速开始

你已经准备好了 7 个词库文件在 `dicts` 文件夹中,现在可以通过以下步骤将数据导入到数据库。

## 📁 已准备的文件

### 词库数据文件 (dicts 文件夹)
- ✅ `primary_school.json` - 小学英语 (565词)
- ✅ `middle_school.json` - 初中英语
- ✅ `high_school.json` - 高中英语
- ✅ `cet4.json` - 大学英语四级
- ✅ `cet6.json` - 大学英语六级
- ✅ `ielts.json` - 雅思
- ✅ `toefl.json` - 托福

### 新创建的脚本文件
- ✅ `server/data/books-config.json` - 词书配置
- ✅ `server/scripts/import-dicts.js` - 批量导入脚本
- ✅ `server/scripts/import-single-dict.js` - 单个导入脚本
- ✅ `server/scripts/verify-data.js` - 数据验证脚本

---

## 🚀 使用步骤

### 步骤 1: 确保数据库已创建

```bash
# 进入 server 目录
cd f:\English\word-learning-app\server

# 创建数据库(如果还没创建)
node scripts/create-database.js
```

### 步骤 2: 导入所有词库数据

```bash
# 批量导入所有 7 个词库
node scripts/import-dicts.js
```

**这个脚本会:**
- 清空现有数据(使用 `force: true`)
- 导入所有 7 个词库
- 创建词书记录
- 导入单词数据
- 建立词书-单词关联
- 显示导入进度和统计信息

**预计耗时:** 5-10 分钟(取决于数据量)

### 步骤 3: 验证数据

```bash
# 验证导入的数据
node scripts/verify-data.js
```

**这个脚本会显示:**
- 单词总数、词书总数、关联记录数
- 每个词书的详细信息
- 数据完整性检查结果
- 示例单词数据

---

## 🎯 可选操作

### 只导入单个词库

如果你只想导入某个特定的词库:

```bash
# 导入小学英语
node scripts/import-single-dict.js --file=primary_school

# 导入四级词汇
node scripts/import-single-dict.js --file=cet4

# 导入雅思词汇
node scripts/import-single-dict.js --file=ielts
```

可用的词库 key:
- `primary_school` - 小学英语
- `middle_school` - 初中英语
- `high_school` - 高中英语
- `cet4` - 大学英语四级
- `cet6` - 大学英语六级
- `ielts` - 雅思
- `toefl` - 托福

---

## 📊 在小程序中使用

### 1. 启动后端服务器

```bash
cd f:\English\word-learning-app\server
npm run dev
```

### 2. 测试 API

**获取词书列表:**
```
GET http://localhost:3000/api/books
```

**获取词书详情:**
```
GET http://localhost:3000/api/books/1
```

**获取词书单词列表:**
```
GET http://localhost:3000/api/books/1/words?page=1&limit=20
```

### 3. 在小程序中使用

小程序会通过这些 API 获取数据:

```javascript
// 在小程序中获取词书列表
const books = await api.getBooks();

// 获取词书单词
const words = await api.getBookWords(bookId, { page: 1, limit: 20 });

// 开始学习
const dailyTask = await api.getDailyTask(bookId);
```

---

## ⚠️ 注意事项

> **重要:** `import-dicts.js` 脚本使用 `force: true`,会删除所有现有数据!
> 
> 如果你已经有用户学习记录,请先备份数据库。

> **提示:** 首次导入建议使用 `import-dicts.js` 批量导入所有词库。
> 
> 后续如需添加新词库,使用 `import-single-dict.js` 单独导入。

---

## 🔧 故障排除

### 问题 1: 数据库连接失败

**解决方案:**
1. 检查 `.env` 文件中的数据库配置
2. 确保 MySQL 服务已启动
3. 确保数据库已创建

### 问题 2: 导入过程中断

**解决方案:**
1. 检查错误日志
2. 重新运行导入脚本(会自动清空并重新导入)

### 问题 3: 单词数量不匹配

**解决方案:**
1. 运行 `node scripts/verify-data.js` 检查数据
2. 如有问题,重新运行导入脚本

---

## 📝 数据格式说明

### 词库 JSON 文件格式

```json
{
  "total_words": 565,
  "description": "词库描述",
  "words": [
    {
      "word": "单词",
      "phonetic_us": "美式音标",
      "phonetic_uk": "英式音标",
      "definitions": [
        {
          "pos": "词性",
          "meaning": "中文释义",
          "examples": ["例句"]
        }
      ]
    }
  ]
}
```

### 数据库表结构

- `words` - 单词表(存储所有单词)
- `books` - 词书表(存储词书信息)
- `book_words` - 词书-单词关联表(多对多关系)

---

## 🎉 下一步

数据导入完成后,你可以:

1. ✅ 在小程序中选择词书开始学习
2. ✅ 查看学习统计
3. ✅ 进行单词测试
4. ✅ 创建生词本

祝你使用愉快! 🚀
